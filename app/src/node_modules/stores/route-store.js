var Fluxxor = require("fluxxor")
var actions = require("actions")
var omit    = require('lodash.omit')

var log     = require('debug')('src:node_modules:stores:route-store')

var RouteStore = Fluxxor.createStore({
  initialize: function (options) {
    this.router         = options.router
    this.currentPath    = options.path
    this.currentParams  = options.params 
    this.currentQuery   = options.query || {} 

    this.bindActions(
      actions.constants.ROUTE.TRANSITION, this.handleRouteTransition
    );
  },

  handleRouteTransition: function (payload) {
    this.currentPath    = payload.path || this.currentPath || '/'
    this.currentParams  = payload.params || this.currentParams
    this.currentQuery   = omit(payload.query, function (val) { return val === '' }) || this.currentQuery

    log('currentQuery', this.currentQuery)

    this.router.transitionTo(this.currentPath, this.currentParams, this.currentQuery)
  },

  getCurrentPath: function () {
    return this.currentPath
  },

  getCurrentParams: function () {
    return this.currentParams
  },

  getCurrentQuery: function () {
    return this.currentQuery
  }
});

module.exports = RouteStore;
