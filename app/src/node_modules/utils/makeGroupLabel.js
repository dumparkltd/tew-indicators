var _ = require('lodash')
var log = require('debug')('utils:makeGroupLabel')

module.exports = function (flux,breakdownIds,datum) {
  log(breakdownIds, datum)

    var label = ''
    var countall = 0
    _.each(breakdownIds, function (bdId,index) {
     var group = datum[bdId]

     if (typeof group !== 'undefined' && group !== 'all' && group !== '') {
       if (label !== '') label += ', '

       var groupInStore = flux.stores.dataGroups.findOne({ breakdown: bdId, short: group })

       if (bdId === 'age' && typeof groupInStore === 'undefined') {
         label += group + ' years'
       } else {
         label += groupInStore.title
       }
       
       if (typeof datum.rank !== 'undefined' && datum.rank !== '') {
         label = datum.rank + '. ' + label
       }

     } else if (group === 'all' && breakdownIds.indexOf(bdId) > -1) {
      countall++
    }

    }, this)

    if (countall === breakdownIds.length) {
      // todo this should check the indicator store
      label = 'All people'
    }

    return label;
}
