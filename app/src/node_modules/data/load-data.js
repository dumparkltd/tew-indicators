var Tabletop = require('tabletop').Tabletop

var tabletop;
var data;

var storeData = function(d){
  data = d
//  dataLoaded = true
}

var waitForData = function(callback){
  if (data){
     callback(data);
  } else {
    setTimeout(function(){
      waitForData(callback);
    },250);
  }                
}

module.exports = function (key, sheet, callback) {
 
  return function () {
    
    if (typeof tabletop === "undefined") {
      tabletop = Tabletop.init({
        key: key,
        callback: storeData,
        prettyColumnNames :false,
        parseNumbers: true,
        proxy: "http://tewdata.s3.amazonaws.com",
      })
    }
    waitForData(callback);
  }

}
