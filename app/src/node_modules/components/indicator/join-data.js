// lodash
var _         = require('lodash') //TODO swap out with custom build using lodash-cli

//logging
var log     = require('debug')('components:indicator:join-data')


module.exports = function (data, datasets) {
  var dataSetIdToYearMap = {}
  _(datasets).each(function (dataset) {
    dataSetIdToYearMap[dataset.id] = dataset['observation_date']
  })

  log('datasets', datasets)

  var mostRecentYear = datasets[0]['observation_date']
  var groupedByDataset = _.groupBy(data, 'data_set')

  return {
    mostRecentYear: mostRecentYear,
    dataSetIdToYearMap: dataSetIdToYearMap,
    groupedByDataset: groupedByDataset
  }
}
