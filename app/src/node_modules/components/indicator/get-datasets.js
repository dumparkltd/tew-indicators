// lodash
var _         = require('lodash') //TODO swap out with custom build using lodash-cli

//logging
var log     = require('debug')('components:indicator:get-datasets')


module.exports = function (data, flux) {
  return _(data)
    .map(function(d) {
      return d.dataset
    })
    .uniq()
    .map(function (datasetId) {
      log('datasetId', datasetId)
      return flux.stores.datasets.findOne({ id: datasetId })
    })
    .compact() //HACK remove falsy
    .sortByOrder(['observation_date'], [false] ) //descending
    .value()
}
