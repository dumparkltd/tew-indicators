//main
var React               = require('react')
var Fluxxor             = require('fluxxor')

//helpers 
var FluxMixin           = Fluxxor.FluxMixin(React)

//components
var SelectGroupGroup    = require('components/select-group-group')
var IndicatorView       = require('components/indicator-view')

//debugging
var log             = require('debug')('src:components:main:index')

module.exports = React.createClass({

  mixins: [
    FluxMixin
  ],

  render: function () {
    var flux             = this.getFlux()
    var groupTypes       = ['ethnicity', "sex", "age", 'disability', 'sogii']
    var indicatorId      = 'unempl'
    var indicatorLabel   = 'Unemployment'
    var queryObject      = {}

    var currentQuery     = flux.stores.route.getCurrentQuery()

    var queryObject      = groupTypes.reduce(function (memo, groupType) {
      memo[groupType] = currentQuery[groupType] || ''
      return memo
    }, {})

    //using lodash.where -> array
    var datum             = flux.stores.data.query(queryObject)[0] || '?'

    log('datum', datum, flux)

    return (
      <div>
        <SelectGroupGroup groupTypes={groupTypes} flux={flux} />
        <IndicatorView 
          id={'indicator-view-'+indicatorId} 
          header={indicatorLabel}
          datum={datum}  />
      </div>
    )

  },

})