//main
var React               = require('react')
var Fluxxor             = require('fluxxor')

var Router        = require('react-router')

var RouteHandler  = Router.RouteHandler

//mixins
var FluxMixin           = Fluxxor.FluxMixin(React)
var StoreWatchMixin     = Fluxxor.StoreWatchMixin

//components
var Header 						= require('../header/')
var Footer            = require('components/footer')

//helpers
var _                   = require('lodash')


//debugging
var log             = require('debug')('src:components:main')

module.exports = React.createClass({

  mixins: [
    FluxMixin,
    StoreWatchMixin(
      'data',
      'dataBreakdowns',
      'dataGroups',
      'datasets',
      'indicators',
      'issues',
      'recommendations'
    )
  ],

  propTypes: {
    flux: React.PropTypes.object
  },

  contextTypes: {
    router: React.PropTypes.func
  },

  getStateFromFlux: function () {
    var flux = this.getFlux();
    return {
      dataLoading : flux.store("data").isLoading(),
      dataBreakdownLoading : flux.store("dataBreakdowns").isLoading(),
      dataGroupsLoading : flux.store("dataGroups").isLoading(),
      datasets : flux.store("datasets").isLoading(),
      indicators : flux.store("indicators").isLoading(),
      issues : flux.store("issues").isLoading(),
      recommendations : flux.store("recommendations").isLoading(),
    }
  },

  render: function () {
    var flux = this.getFlux()
    log('rendering main ...', this.props, this.state)

    return (
      <div className='home'>
        <Header
          currentHREF = {window.location.href}
          isIntro = {flux.stores.routes.getCurrentRoute() === 'intro'}
          title = 'Tracking Equality of Work'
          subtitle = "Monitoring fairness at work"
          flux={flux} />
        <RouteHandler flux={flux}/>
        <Footer
          shouldHide = {flux.stores.routes.getCurrentRoute() === 'intro'}
          infoText = "Every care has been taken to ensure the accuracy of this data. Any errors are ours and will be corrected online. Please send any feedback to "
          infoEmail = "infoline@hrc.co.nz"
          dumparkLink = "interactive by dumpark"
          parentSiteText = "Visit our website to learn more about Human Rights in New Zealand"
          parentSiteAnchorText = "www.hrc.co.nz"
          parentSiteURL = "http://hrc.co.nz"
          />
      </div>
    )
  },
})
