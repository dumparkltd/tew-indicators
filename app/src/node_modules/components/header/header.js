//main
var React       = require('react')

//helpers
var _ 					= require('lodash')

var Grid            = require('react-bootstrap/lib/Grid')
var Nav             = require('react-bootstrap/lib/Nav')
var Navbar          = require('react-bootstrap/lib/Navbar')
var NavItem 				= require('react-bootstrap/lib/NavItem')
var ShareModal      = require('components/share-modal')


//logging
var log       	= require('debug')('components:header')

module.exports = React.createClass({

  propTypes: {
    currentHREF : React.PropTypes.string,
    IsIntro     : React.PropTypes.bool,
    title       : React.PropTypes.string,
    subtitle    : React.PropTypes.string,
    flux        : React.PropTypes.object,
  },

  getInitialState: function () {
    return {
      hideShareModal: true
    }
  },

  render: function () {
		log('props', this.props, window.location)

    var Brand = this.props.isIntro ? (
      <div className='header-logo'>
        <a className="icon-hrc-logo " href="http://hrc.co.nz" target="_blank"></a>
      </div>
    ) : (
      <div className='header-logo'>
        <a className="icon-hrc-logo-sm " href="http://hrc.co.nz" target="_blank"></a>
      </div>
    )

    var Title = (
      (this.props.isIntro) ? null :
        <NavItem className='title' onClick={this.handleNavClick('home')} >
          <h3>{this.props.title}</h3>
          <p>{this.props.subtitle}</p>
        </NavItem>
    )

    var RightNav = this.props.isIntro ? (
      <Nav right >
        <div>
          <a className="icon-hrc-claim " href="http://hrc.co.nz" target="_blank"></a>
        </div>
      </Nav>
    ) : (
      <Nav right>
        <NavItem href='#' onClick={this.handleNavClick('about')}>About</NavItem>
        <NavItem href='#' onClick={this.toggleShareModal()}>Share</NavItem>
      </Nav>
    )


		return (
        <div className="navbar-tew-wrapper">
      		<Navbar className='navbar-tew' brand={Brand}>
            <Nav>
              {Title}
            </Nav>
            { RightNav }
          </Navbar>
          <ShareModal
            shareTweet="Check out this cool Tracking Equality at Work site from @NZHumanRights"
            shareTitle="Tracking Equality at Work - visualising inequality in NZ workplaces"
            currentHREF={this.props.currentHREF}
            shouldHide={this.state.hideShareModal}
            toggleShareModal={this.toggleShareModal} />
        </div>

    )
  },

  handleNavClick: function (page) {
    var flux = this.props.flux

    return function (e) {
      e.preventDefault()
      flux.actions.navPage(page)
    }
  },

  toggleShareModal: function () {
    log('init')
    var self = this
    return function (e) {
      e.preventDefault()
      self.setState({ hideShareModal: !self.state.hideShareModal })
    }
  }
})
