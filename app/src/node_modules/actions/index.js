var log       = require('debug')('actions:index')
var isArray   = require('isarray')
var contains  = require('lodash.contains')
var clone     = require('lodash.clone')
var _         = require('lodash')

var c = {

  ROUTE: {
    TRANSITION: "ROUTE:TRANSITION",
    GROUP: {
      SELECT: "ROUTE:GROUP:SELECT"
    }
  },

  GROUP: {
    SELECT: "GROUP:SELECT"
  }

};

var methods = {
  routes: {
    transition: function (path, params, query) {
      this.dispatch(c.ROUTE.TRANSITION, { path: path, params: params, query: query });
    }
  },


  group: {
    select: function (groupType, selectedValues, currentQuery) {
      if (!isArray(selectedValues)) throw new Error('selectedValues must be an array')
      var query = clone(currentQuery)
      var currentValues = query[groupType] ? query[groupType].split(',') : null
      log('query', query)
      log('currentValues', currentValues)
      log('selectedValues', selectedValues)

      query[groupType] = currentValues ? _.union(currentValues, selectedValues).join(',') : selectedValues.join(',')
      log('query2', query)

      this.dispatch(c.ROUTE.TRANSITION, { query: query })
    }
  }
};

module.exports = {
  methods: methods,
  constants: c
};
